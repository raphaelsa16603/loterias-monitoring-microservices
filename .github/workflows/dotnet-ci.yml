name: Build Core Libraries (.NET 8)

on:
  push:
    branches: [ main, develop, feature/** ]
  pull_request:
    branches: [ main, develop ]

jobs:
  build-core-libs:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup .NET 8 SDK
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 8.0.x

      - name: Cache NuGet packages
        uses: actions/cache@v4
        with:
          path: ~/.nuget/packages
          key: ${{ runner.os }}-nuget-${{ hashFiles('**/packages.lock.json') }}
          restore-keys: |
            ${{ runner.os }}-nuget-

      # ðŸ§± Build Loterias.Shared
      - name: Clean previous build (Shared)
        run: |
          echo "ðŸ§¹ Limpando pastas anteriores..."
          rm -rf Loterias.Shared/bin Loterias.Shared/obj || true

      - name: Restore dependencies (Loterias.Shared)
        run: dotnet restore Loterias.Shared/Loterias.Shared.csproj

      - name: Build Loterias.Shared
        run: dotnet build Loterias.Shared/Loterias.Shared.csproj --configuration Release --no-restore

      - name: Verify output (Shared)
        run: |
          echo "âœ… Build concluÃ­do: Loterias.Shared"
          ls -l Loterias.Shared/bin/Release/net8.0/ || true

      # ðŸ§© Build Loterias.Logging.Common
      - name: Clean previous build (Logging.Common)
        run: |
          echo "ðŸ§¹ Limpando pastas anteriores..."
          rm -rf Loterias.Logging.Common/bin Loterias.Logging.Common/obj || true

      - name: Restore dependencies (Loterias.Logging.Common)
        run: dotnet restore Loterias.Logging.Common/Loterias.Logging.Common.csproj

      - name: Build Loterias.Logging.Common
        run: dotnet build Loterias.Logging.Common/Loterias.Logging.Common.csproj --configuration Release --no-restore

      - name: Verify output (Logging.Common)
        run: |
          echo "âœ… Build concluÃ­do: Loterias.Logging.Common"
          ls -l Loterias.Logging.Common/bin/Release/net8.0/ || true

      # ðŸŽ¯ Build Loterias.CaixaClientLib
      - name: Clean previous build (CaixaClientLib)
        run: |
          echo "ðŸ§¹ Limpando pastas anteriores..."
          rm -rf Loterias.CaixaClientLib/bin Loterias.CaixaClientLib/obj || true

      - name: Restore dependencies (Loterias.CaixaClientLib)
        run: dotnet restore Loterias.CaixaClientLib/Loterias.CaixaClientLib.csproj

      - name: Build Loterias.CaixaClientLib
        run: dotnet build Loterias.CaixaClientLib/Loterias.CaixaClientLib.csproj --configuration Release --no-restore

      - name: Verify output (CaixaClientLib)
        run: |
          echo "âœ… Build concluÃ­do: Loterias.CaixaClientLib"
          ls -l Loterias.CaixaClientLib/bin/Release/net8.0/ || true
